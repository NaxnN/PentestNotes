### powershell find, powershell search file 
powershell:
```powershell
Get-ChildItem -Filter *.txt -Recurse -ErrorAction SilentlyContinue
Get-ChildItem -R -include *test* -ErrorAction SilentlyContinue
Get-ChildItem -R -include *.txt,*.ini -ErrorAction SilentlyContinue
```

### log file location
```powershell
$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\  # psreadline (Get-PSReadlineOption).HistorySavePath
Start-Transcript -path ... # PowerShell Transcription
Get-WinEvent -FilterHashtable @{logname = "Microsoft-Windows-PowerShell/Operational"; id = 4104 } | select -ExpandProperty message # Script Block Logging in event viewer  # location in event viewer: Microsoft->Windows->PowerShell->Operational
```


## get installed applications
```powershell
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname 
```

### Disable Windows Defender (Need high privilege)

#### check Windows AV:
```powershell
Get-MpPreference |Select-Object DisableRealtimeMonitoring
# do not work in winrm under a no privileged user

# cmd, use double quotes, not single quotes
powershell -c "Get-MpPreference |Select-Object DisableRealtimeMonitoring"
```
#### disable Windows AV:
```powershell
Set-MpPreference -DisableRealtimeMonitoring $true

# cmd, use double quotes, not single quotes
powershell -c "Set-MpPreference -DisableRealtimeMonitoring $true"
```

### windows hosts file location
`C:\Windows\System32\drivers\etc\hosts`


### account having administrative privileges
```shell
net localgroup administrators
```

### sudo -l
`whoami /priv`

### windows webserver file folder
`/inetpub/wwwroot`

### psexec
impacket-psexec test.local/john:password123@10.10.10.1

```powershell 
 .\PsExec.exe -s -i powershell.exe # local admin to nt authority\system
```
### multiline string
```powershell
# don't substitute $variable inside
$a=@'
...
'@
```
```powershell
# substitute $variable inside
$a=@"
...
"@
```

## powershell zip and unzip file
```powershell
Compress-Archive -Path <SourcePathofResource> -DestinationPath <DestinationZipFilePath>
Expand-Archive -Path <SourcePathofZipFile> -DestinationPath <DestinationPath>
#  .zip is the only supported archive file format
#  ./busybox.exe gunzip
```

## host discovery
```cmd
for /L %z in (1,1,254) do @ping 192.168.0.%z -w 10 -n 1 | findstr C:/"Reply"
```

## powershell tee
```powershell
Get-Process | Tee-Object -FilePath "C:\Test1\testfile2.txt"
```

## powershell hash
```powershell
Get-FileHash <filepath> -Algorithm MD5
```

## powershell grep
```powershell
Select-String -Path "Users\*.csv" -Pattern "Joe"
ls |findstr C:/"csv"
```

## powershell base64
```shell
certutil -encode file.exe file.exe.b64
certutil -decode file.exe.b64 file.exe
.\busybox.exe base64  .\file.exe | .\busybox.exe tee file.exe.b64

[System.IO.File]::WriteAllBytes("/users/test4/desktop/test",[System.Convert]::FromBase64String("YXNkZg=="))
```
<!-- has utf-16le effect on base64 -->
<!-- ```powershell
# Encoding:
$Text = 'This is a secret and should be hidden'
$Bytes = [System.Text.Encoding]::Unicode.GetBytes($Text)
$EncodedText =[Convert]::ToBase64String($Bytes)
$EncodedText
```
```powershell
$EncodedText = "VABoAGkAcwAgAGkAcwAgAGEAIABzAGUAYwByAGUAdAAgAGEAbgBkACAAcwBoAG8AdQBsAGQAIABiAGUAIABoAGkAZABlAG4A"
$DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
$DecodedText
``` -->

## powershell xattr ( Alternate Data Streams )
```powershell
get-item -stream * <filename>
get-content -stream <stream_name> <filename>
```

## powershell xxd
```powershell
Format-Hex
```

## powershell ps
```powershell
# The 'IncludeUserName' parameter requires elevated user rights.
ps -IncludeUserName
Get-Process -IncludeUserName
ps -id <pid>|select *
```

## powershell ls
```powershell
# list items by time
ls | sort LastWriteTime -Descending
```

## language mode
```powershell
# check if PowerShell is in Constrained Language Mode
$ExecutionContext.SessionState.LanguageMode # ConstrainedLanguage
```

## applocker policy
```powershell
Get-AppLockerPolicy -effective -xml
```


## get services
```powershell
Get-CimInstance -ClassName win32_service | Select Name,State,PathName,StartMode | findstr -v svchost

net stop <service>
net start <service>
Restart-Service <service>

shutdown /r /t 0
```

## Invoke-WebRequest or curl
```
$ProgressPreference = 'SilentlyContinue'
...
```

## powersehell separator
`;`

### cmd separator
`&` `&&`